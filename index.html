<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>Ø¯ÛŒÙˆØ§Ø± Ø±ÙˆØ³ØªØ§ â€” Yari</title>
<style>
    body{
        font-family: sans-serif;
        direction: rtl;
        background:#f2f2f2;
        margin:0;
        padding:0;
    }

    .container{
        width:90%;
        max-width:700px;
        margin:auto;
        padding:20px;
    }

    button{
        padding:10px 15px;
        background:#007bff;
        border:none;
        color:white;
        border-radius:6px;
        cursor:pointer;
    }
    button:hover{ background:#005fcc; }

    .card{
        background:white;
        padding:12px;
        margin-bottom:12px;
        border-radius:7px;
        box-shadow:0 0 3px rgba(0,0,0,0.2);
    }

    .hidden{display:none;}

    input,textarea{
        width:100%;
        padding:8px;
        margin-bottom:10px;
        border-radius:6px;
        border:1px solid #aaa;
    }

    .error{
        background:#ffe1e1;
        border:1px solid red;
        padding:10px;
        margin:10px 0;
    }

</style>
</head>
<body>

<div class="container" id="pageHome">
    <h1>ğŸŒ¾ Ø¯ÛŒÙˆØ§Ø± Ø±ÙˆØ³ØªØ§</h1>
    <p>Ø«Ø¨Øª Ø¢Ú¯Ù‡ÛŒ â€” Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§</p>

    <button onclick="showPage('pageAdd')">â• Ø«Ø¨Øª Ø¢Ú¯Ù‡ÛŒ</button>
    <button onclick="showPage('pageList')">ğŸ“‹ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§</button>
</div>


<!-- ØµÙØ­Ù‡ Ø«Ø¨Øª Ø¢Ú¯Ù‡ÛŒ -->
<div class="container hidden" id="pageAdd">
    <h2>Ø«Ø¨Øª Ø¢Ú¯Ù‡ÛŒ ğŸ“</h2>

    <input id="title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø¢Ú¯Ù‡ÛŒ">
    <input id="price" placeholder="Ù‚ÛŒÙ…Øª (ØªÙˆÙ…Ø§Ù†)">
    <textarea id="desc" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª"></textarea>

    <p>Ø§Ù†ØªØ®Ø§Ø¨ 3 ØªØµÙˆÛŒØ± (Ø­Ø¯Ø§Ú©Ø«Ø±)</p>
    <input type="file" id="imgs" accept="image/*" multiple>

    <div id="errBox"></div>

    <button onclick="uploadAd()">ğŸ“Œ Ø«Ø¨Øª Ù†Ù‡Ø§ÛŒÛŒ</button>
    <button onclick="showPage('pageHome')">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
</div>


<!-- ØµÙØ­Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø¢Ú¯Ù‡ÛŒ Ù‡Ø§ -->
<div class="container hidden" id="pageList">
    <h2>ğŸ“¢ Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ÛŒ Ø«Ø¨Øª Ø´Ø¯Ù‡</h2>
    <div id="adsBox">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>
    <br>
    <button onclick="showPage('pageHome')">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
</div>


<!-- ØµÙØ­Ù‡ Ø®Ø·Ø§ -->
<div class="container hidden" id="pageError">
    <h2>âš ï¸ Ø®Ø·Ø§</h2>
    <p id="errText">Ù…Ø´Ú©Ù„ ØºÛŒØ±Ù…Ù†ØªØ¸Ø±Ù‡ Ø±Ø® Ø¯Ø§Ø¯.</p>
    <button onclick="showPage('pageHome')">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
</div>


<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>

<script>
// ------------------ Firebase Config ------------------
const firebaseConfig = {
  apiKey: "AIzaSyDrw4BGlqE73KzqfvlffD5njbK_HZWJP0s",
  authDomain: "yarivag-sity.firebaseapp.com",
  projectId: "yarivag-sity",
  storageBucket: "yarivag-sity.firebasestorage.app",
  messagingSenderId: "481949392702",
  appId: "1:481949392702:web:bba54ec37dc19e6db4166f",
  measurementId: "G-WMY8E6WY6F"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ------------------ imgbb key ------------------
const imgbbKey = "15848ef4bdb83801fddd4f3c173a4072";


// -------- ØªØºÛŒÛŒØ± ØµÙØ­Ù‡ --------
function showPage(id){
    document.querySelectorAll(".container").forEach(c=>c.classList.add("hidden"));
    document.getElementById(id).classList.remove("hidden");
}


// -------- Ù†Ù…Ø§ÛŒØ´ Ø®Ø·Ø§ --------
function showError(msg){
    document.getElementById("errBox").innerHTML = `<div class="error">${msg}</div>`;
}


// ------------------ Ø¢Ù¾Ù„ÙˆØ¯ Ø¢Ú¯Ù‡ÛŒ ------------------
async function uploadAd(){
    const title = title.value.trim();
    const price = price.value.trim();
    const desc  = desc.value.trim();
    const files = imgs.files;

    if(!title || !price){
        showError("Ø¹Ù†ÙˆØ§Ù† Ùˆ Ù‚ÛŒÙ…Øª Ø§Ù„Ø²Ø§Ù…ÛŒ Ù‡Ø³ØªÙ†Ø¯");
        return;
    }

    if(files.length === 0){
        showError("Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ø¹Ú©Ø³ Ø§Ù†ØªØ®Ø§Ø¨ Ø´ÙˆØ¯");
        return;
    }

    if(files.length > 3){
        showError("Ø­Ø¯Ø§Ú©Ø«Ø± Û³ Ø¹Ú©Ø³ Ù…Ø¬Ø§Ø² Ø§Ø³Øª");
        return;
    }

    try{
        let urls = [];

        // 1: Ø¢Ù¾Ù„ÙˆØ¯ Ù‡Ø± Ø¹Ú©Ø³ Ø¨Ù‡ imgbb
        for(let f of files){
            let form = new FormData();
            form.append("image", f);

            let res = await fetch(`https://api.imgbb.com/1/upload?key=${imgbbKey}`,{
                method:"POST",
                body:form
            });

            let json = await res.json();
            if(!json.data) throw("Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯ ØªØµÙˆÛŒØ±");
            urls.push(json.data.url);
        }

        // 2: Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Firebase
        await db.collection("ads").add({
            title, price, desc,
            imgs: urls,
            time: Date.now()
        });

        alert("Ø¢Ú¯Ù‡ÛŒ Ø«Ø¨Øª Ø´Ø¯ âœ”ï¸");
        showPage('pageHome');

    }catch(err){
        document.getElementById("errText").innerHTML = err.toString();
        showPage("pageError");
    }
}


// ------------------ Ø¯Ø±ÛŒØ§ÙØª Ø¢Ú¯Ù‡ÛŒ Ù‡Ø§ ------------------
async function loadAds(){
    const box = document.getElementById("adsBox");
    box.innerHTML = "Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª...";

    let q = await db.collection("ads").orderBy("time","desc").get();
    box.innerHTML = "";

    q.forEach(doc=>{
        let d = doc.data();
        let imgs = d.imgs.map(i=>`<img src="${i}" width="100" style="margin:3px;border-radius:6px;">`).join("");

        box.innerHTML += `
        <div class="card">
            <b>${d.title}</b> â€” ${d.price} ØªÙˆÙ…Ø§Ù† <br>
            ${d.desc}<br>
            <div>${imgs}</div>
        </div>`;
    });

    if(box.innerHTML === "") box.innerHTML = "Ù‡ÛŒÚ† Ø¢Ú¯Ù‡ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡.";
}

showAds = loadAds;
loadAds();
</script>
</body>
</html>
