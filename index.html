<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>Ø¯ÛŒÙˆØ§Ø± Ø±ÙˆØ³ØªØ§ â€” crudcrud</title>
<style>
body{
    font-family: sans-serif;
    direction: rtl;
    background:#f2f2f2;
    margin:0; padding:0;
}
.container{
    width:90%;
    max-width:700px;
    margin:auto;
    padding:20px;
}
button{
    padding:10px 15px;
    background:#007bff;
    border:none;
    color:white;
    border-radius:6px;
    cursor:pointer;
}
button:hover{ background:#005fcc; }
.card{
    background:white;
    padding:12px;
    margin-bottom:12px;
    border-radius:7px;
    box-shadow:0 0 3px rgba(0,0,0,0.2);
}
.hidden{display:none;}
input,textarea{
    width:100%;
    padding:8px;
    margin-bottom:10px;
    border-radius:6px;
    border:1px solid #aaa;
}
.error{
    background:#ffe1e1;
    border:1px solid red;
    padding:10px;
    margin:10px 0;
}
</style>
</head>
<body>

<div class="container" id="pageHome">
    <h1>ğŸŒ¾ Ø¯ÛŒÙˆØ§Ø± Ø±ÙˆØ³ØªØ§</h1>
    <p>Ø«Ø¨Øª Ø¢Ú¯Ù‡ÛŒ â€” Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§</p>
    <button onclick="showPage('pageAdd')">â• Ø«Ø¨Øª Ø¢Ú¯Ù‡ÛŒ</button>
    <button onclick="showPage('pageList')">ğŸ“‹ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§</button>
</div>

<div class="container hidden" id="pageAdd">
    <h2>Ø«Ø¨Øª Ø¢Ú¯Ù‡ÛŒ ğŸ“</h2>
    <input id="title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø¢Ú¯Ù‡ÛŒ">
    <input id="price" placeholder="Ù‚ÛŒÙ…Øª (ØªÙˆÙ…Ø§Ù†)">
    <textarea id="desc" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª"></textarea>
    <div id="errBox"></div>
    <button onclick="submitAd()">ğŸ“Œ Ø«Ø¨Øª Ù†Ù‡Ø§ÛŒÛŒ</button>
    <button onclick="showPage('pageHome')">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
</div>

<div class="container hidden" id="pageList">
    <h2>ğŸ“¢ Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ÛŒ Ø«Ø¨Øª Ø´Ø¯Ù‡</h2>
    <div id="adsBox">Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª...</div>
    <br>
    <button onclick="showPage('pageHome')">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
</div>

<script>
// ======== API endpoint Ø´Ù…Ø§ ========
const endpoint = 'https://crudcrud.com/api/30e7d4246d234e7ea7efff3107cd5328/ads';

function showPage(id){
    document.querySelectorAll(".container").forEach(c=>c.classList.add("hidden"));
    document.getElementById(id).classList.remove("hidden");
    if(id === "pageList") loadAds();
}

function showError(msg){
    document.getElementById("errBox").innerHTML = `<div class="error">${msg}</div>`;
}

async function addAd(title, price, desc){
    const ad = { title, price, desc, time: Date.now() };
    const res = await fetch(endpoint, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(ad)
    });
    return res.ok;
}

async function loadAds(){
    const box = document.getElementById("adsBox");
    box.innerHTML = "Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª...";
    try{
        const res = await fetch(endpoint);
        const ads = await res.json();
        if(ads.length === 0){
            box.innerHTML = "Ù‡ÛŒÚ† Ø¢Ú¯Ù‡ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡.";
            return;
        }
        box.innerHTML = "";
        ads.slice().reverse().forEach(a=>{
            const date = new Date(a.time).toLocaleString("fa-IR");
            box.innerHTML += `
            <div class="card">
                <b>${a.title}</b> â€” ${a.price} ØªÙˆÙ…Ø§Ù†<br>
                ${a.desc}<br>
                <small style="color:#555">ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª: ${date}</small>
            </div>`;
        });
    }catch(e){
        box.innerHTML = "Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§";
        console.error(e);
    }
}

function submitAd(){
    const title = document.getElementById("title").value.trim();
    const price = document.getElementById("price").value.trim();
    const desc = document.getElementById("desc").value.trim();

    if(!title || !price){
        showError("Ø¹Ù†ÙˆØ§Ù† Ùˆ Ù‚ÛŒÙ…Øª Ø§Ù„Ø²Ø§Ù…ÛŒ Ù‡Ø³ØªÙ†Ø¯");
        return;
    }
    if(isNaN(price) || Number(price)<=0){
        showError("Ù‚ÛŒÙ…Øª Ø¨Ø§ÛŒØ¯ Ø¹Ø¯Ø¯ÛŒ Ù…Ø«Ø¨Øª Ø¨Ø§Ø´Ø¯");
        return;
    }

    addAd(title, Number(price), desc).then(ok=>{
        if(ok){
            alert("Ø¢Ú¯Ù‡ÛŒ Ø«Ø¨Øª Ø´Ø¯ âœ”ï¸");
            document.getElementById("title").value="";
            document.getElementById("price").value="";
            document.getElementById("desc").value="";
            showPage('pageHome');
        } else {
            showError("Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª Ø¢Ú¯Ù‡ÛŒ");
        }
    });
}
</script>

</body>
</html>
